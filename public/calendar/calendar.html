<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue Schedule App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3.2.45/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
<div id="app">
    <div class="container">
        <div class="d-flex justify-content-between mb-3">
          <div>
            <label for="monthSelect">Month</label>
            <select id="monthSelect" class="form-select" v-model="selectedMonth">
              <option
                v-for="month in months"
                :key="month.value"
                :value="month.value"
              >
                {{ month.name }}
              </option>
            </select>
          </div>
          <!--<div>
            <button class="btn" @click="toggleView('list')">List View</button>
            <button class="btn btn-outline-primary" @click="toggleView('calendar')">
              Calendar View
            </button>
          </div>-->
        </div>
            <!-- Calendar View -->
            <div v-if="viewType === 'calendar'" class="calendar">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th v-for="day in daysOfWeek" :key="day">{{ day }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="week in calendarWeeks" :key="week">
                            <td v-for="day in week" :key="day.date">
                                <div :class="['calendar-day', { today: isToday(day.date) }]">
                                    <span>{{ day.dayNumber }}</span>
                                    <div v-if="day.events.length" class="events">
                                        <div v-for="event in day.events" :key="event.name" :class="['event', event.type === 'office' ? 'text-warning' : 'text-success']">
                                            {{ event.name }} {{ event.type === 'office' ? 'in Office' : 'WFH' }}
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- <br><br>
            <h1 v-for="goobye in hello">{{goobye}} {{goodbye}}</h1> -->
            <br>
            <!-- {{distance.rows[0].elements[0].distance.text}} -->
            <br>
            Test firestore connection with flask: {{testing_firestore_connection}}
    </div>
</div>
<script>
const { createApp } = Vue;

        createApp({
            data() {
                return {
                    selectedMonth: new Date().getMonth() + 1,
                    viewType: "calendar",
                    daysOfWeek: ["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"],
                    months: [
                        { name: "Jan", value: 1 },
                        { name: "Feb", value: 2 },
                        { name: "Mar", value: 3 },
                        { name: "Apr", value: 4 },
                        { name: "May", value: 5 },
                        { name: "Jun", value: 6 },
                        { name: "Jul", value: 7 },
                        { name: "Aug", value: 8 },
                        { name: "Sep", value: 9 },
                        { name: "Oct", value: 10 },
                        { name: "Nov", value: 11 },
                        { name: "Dec", value: 12 },
                    ],
                    dummyEvents: [
                        { name: "Sarah Koh", date: "2024-09-10", type: "office" },
                        { name: "Mary Tan", date: "2024-10-03", type: "office" },
                        { name: "Sean Goh", date: "2024-10-03", type: "office" },
                        { name: "Elliot Tay", date: "2024-10-03", type: "wfh" },
                    ],
                    hello: {"Hello":"World"},
                    goodbye: "maybe",
                    distance: { "destination_addresses": [ "Singapore 544692" ], "origin_addresses": [ "Singapore 541281" ], "rows": [ { "elements": [ { "distance": { "text": "0.8 km", "value": 767 }, "duration": { "text": "3 mins", "value": 198 }, "status": "OK" } ] } ], "status": "OK" },
                    testing_firestore_connection: "Delulu",
                };
            },
            computed: {
                calendarWeeks() {
        const firstDayOfMonth = new Date(
            new Date().getFullYear(),
            this.selectedMonth - 1,
            1
        );

        const lastDayOfMonth = new Date(
            new Date().getFullYear(),
            this.selectedMonth,
            0
        );

        // Calculate the start day based on the first day of the month
        const startDate = (firstDayOfMonth.getDay() === 0 ? -6 : 1 - firstDayOfMonth.getDay());
        const daysArray = [];
        let week = [];

        // Adjust the loop to create weeks
        for (let i = startDate; i <= lastDayOfMonth.getDate(); i++) {
            const dayDate = new Date(
                new Date().getFullYear(),
                this.selectedMonth - 1,
                i
            );

            const dayEvents = this.dummyEvents.filter(
                (event) => event.date === new Date((dayDate.getTime() + 24 * 60 * 60 * 1000)).toISOString().split("T")[0]
            );

            week.push({
                date: dayDate,
                dayNumber: i > 0 ? i : "",
                events: dayEvents,
            });

            // Push the week to daysArray when it's full (7 days)
            if (week.length === 7) {
                daysArray.push(week);
                week = [];
            }
            console.log("This is the daysArray variable:",daysArray)
        }

        // Add the last week if it has days
        if (week.length) {
            while (week.length < 7) {
                week.push({
                    date: null,  // Placeholder for empty days
                    dayNumber: "",
                    events: [],
                });
            }
            daysArray.push(week);
        }
        returned_daysarray = daysArray.filter(week => week.some(day => day.dayNumber !== ""));
        console.log("This is the returned days array variable: ", returned_daysarray);
        return daysArray.filter(week => week.some(day => day.dayNumber !== ""));
    },
    },
    methods: {
    toggleView(view) {
        this.viewType = view;
    },
    formatDate(dateStr) {
        return new Date(dateStr).toLocaleDateString("en-US");
    },
    isToday(date) {
        if (!date) return false; // Guard against null
        const today = new Date().toISOString().split('T')[0];
        return date.toISOString().split('T')[0] === today;
    },
    runsomething(){
        axios.get("http://brandynchua.pythonanywhere.com/basic_api/hello_world")
            .then(response => {
                this.hello = response.data;
                console.log(this.hello);
            })
            .catch(error => {
                console.log("Why hello no world");
            });
    },
    /*distance_calc(){
        axios.get("https://maps.googleapis.com/maps/api/distancematrix/json", {
            params: {
                origins: "541281",
                destinations: "544692",
                units: 'metric',
                key:"AIzaSyDMVLNAVZDmwJE61B84MR-jNsr5YHuzSSc"
            }
        })
        .then(response => {
            this.distance = response.data; 
            console.log(distance); 
        })
        .catch(error => {
            console.error('Error fetching distance:', error);
        }); 
    }*/
    /*distance_calc(){
        axios.get("http://brandynchua.pythonanywhere.com/google_api/distancegetter", {
            params: {
                origins: "738343",
                destinations: "Suntec Convention Centre",//"739980",
                units: 'metric',
                //key:""
            }
        })
        .then(response => {
            this.distance = response.data; 
            console.log(this.distance); 
        })
        .catch(error => {
            console.error('Error fetching distance:', error);
        }); 
    }, */

    firestore_test(){
        axios.get("http://brandynchua.pythonanywhere.com/firestore_api")
        .then(response =>{
            this.testing_firestore_connection = response.data;
            console.log(this.testing_firestore_connection)
        })
        .catch(error=>{
            console.error("Firestore is ded wtf?: ", error);
        });
    }
},


        created(){
            this.runsomething();
            this.distance_calc();
            this.firestore_test();
        }
        
        }).mount('#app');

/*        axios.get("https://maps.googleapis.com/maps/api/distancematrix/json", {
            params: {
                origins: "521245 Tampines Street 21",
                destinations: "Tampines Mall",
                units: 'metric',
                key:AIzaSyDMVLNAVZDmwJE61B84MR-jNsr5YHuzSSc
            }
        })
        .then(response => {
            const test = response.data; 
            console.log(test); 
        })
        .catch(error => {
            console.error('Error fetching distance:', error);
        }); */


    </script>

</body>
</html>