<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics</title>
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous"
    />
    <link rel="stylesheet" href="homepage.css" />
    <script src="https://unpkg.com/vue@3.2.45/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-storage-compat.js"></script>
    <script src="../config.js"></script> <!-- Firebase config file -->

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        canvas {
            max-width: 600px;
            /*margin: 20px auto;*/
        }
    </style>

</head>
<body>
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <!-- Navbar Brand -->
                <a class="navbar-brand" href="#">
                    <img src="images/Volunteer.png" alt="logo"/>
                </a>
    
                <!-- Toggler for mobile view -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
    
                <!-- Navbar Links-->
                <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" id="active"  href="#">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link"  href="../explore/exploreafterlogin.html">Explore</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../calendar/calendar.html">Calendar</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../donation/donateaftlogin.html">Donate</a>
                        </li>
                    </ul>
                </div>
    
                <!-- Sign In Button on the far right -->
                <div class="d-flex">
                    <button id="signin" class="btn" type="button">My Profile</button>
                </div>
            </div>
        </nav>
    <div id="charts">
        <h2>Availability Chart</h2>
        <canvas id = "availchart"></canvas>
        <h2>Skills Chart</h2>
        <canvas id="skillschart"></canvas>
    </div>  
<script>
const { createApp } = Vue;

createApp({
    data(){
        return{
            avail_label: [],
            avail_data: [],
            availchart: null, 
            skill_label: [],
            skill_data: [],
            skillchart: null,
        }
    },
    mounted(){
        this.avail_data_call();
        this.skills_data_call();
    },
    methods: {
        avail_data_call(){
            axios.get("http://brandynchua.pythonanywhere.com/chart_processing_api").then(response=>{
                var returned_stuff = response.data
                var avail_label_prep = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
                var avail_data_prep = []
                for(x of avail_label_prep){
                    avail_data_prep.push(returned_stuff[x])
                }
                this.avail_label = avail_label_prep
                this.avail_data = avail_data_prep
                this.createAvailCharts();
            })
            .catch(error=>{
                console.error("API Ded", error)
            })
        },
        createAvailCharts(){
            const availCtx = document.getElementById('availchart').getContext('2d');
            this.availchart = new Chart(availCtx, {
                type: 'bar',
                data: {
                    labels: this.avail_label,
                    datasets: [{
                        label: "Org Requested Days",
                        data: this.avail_data,
                        backgroundColor: 'rgba(153, 102, 255, 0.6)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            })
        },

        createSkillsCharts(){
            const skillsCtx = document.getElementById('skillschart').getContext('2d');
            this.availchart = new Chart(skillsCtx, {
                type: 'bar',
                data: {
                    labels: this.skill_label,
                    datasets: [{
                        label: "In demand skills",
                        data: this.skill_data,
                        backgroundColor: 'rgba(153, 102, 255, 0.6)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            })
        },

        skills_data_call(){
            axios.get("http://brandynchua.pythonanywhere.com/chart_processing_api_skills")
            .then(response=> {
            var skills_data = response.data
            console.log(skills_data)
            var skills_data_label = []
            var skills_data_data = []
            for(let [x, value] of Object.entries(skills_data)){
                skills_data_label.push(x)
                skills_data_data.push(value)
            }
            this.skill_label = skills_data_label
            this.skill_data = skills_data_data
            this.createSkillsCharts();


            })
            .catch(error=>{
                console.error("Error fetching skills data: ",error)
            })
        },

    }
}).mount('#charts')




/*
axios.get("http://127.0.0.1:5000/chart_processing_api")
.then(response=> {
    var returned_stuff = response.data
    console.log(returned_stuff)
    var avail_label = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
    var avail_data = []
    for(x of avail_label){
        avail_data.push(returned_stuff[x])
    }
    console.log(avail_label)
    console.log(avail_data)
    //const availability_labels = Object.keys(returned_stuff)
    //const availability_data = Object.values(returned_stuff)
    //console.log("This is the availability_labels: ", availability_labels)
    //console.log("This is the availability_data: ", availability_data)
})
.catch(error=>{
    console.error("Firestore is ded wtf?: ", error);
})
*/
/*
axios.get("http://127.0.0.1:5000/chart_processing_api_skills")
.then(response=> {
    var returned_stuff = response.data
    console.log(returned_stuff)
    //var avail_label = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
    //var avail_data = []
    //for(x of avail_label){
    //    avail_data.push(returned_stuff[x])
    //}
    //console.log(avail_label)
    //console.log(avail_data)
    //const availability_labels = Object.keys(returned_stuff)
    //const availability_data = Object.values(returned_stuff)
    //console.log("This is the availability_labels: ", availability_labels)
    //console.log("This is the availability_data: ", availability_data)
})
.catch(error=>{
    console.error("Firestore is ded wtf?: ", error);
})
*/
</script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" 
integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" 
crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" 
integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" 
crossorigin="anonymous"></script>

</body>
</html>